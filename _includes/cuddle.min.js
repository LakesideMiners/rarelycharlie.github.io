Persist={cuddle:function(e){var t=JSON.parse(localStorage.getItem("cuddle"));if(t||(t=[]),t.indexOf(e)>=0)return!1;for(;t.length>100;)t.shift();return t.push(e),localStorage.setItem("cuddle",JSON.stringify(t)),!0},forgetme:function(){localStorage.removeItem("whoami")},rememberme:function(e){localStorage.setItem("whoami",e)},whoami:function(){return localStorage.getItem("whoami")}},checksum=function(e){for(var t=305419896,n=e.length,o=0;o<n;o++)t+=e.charCodeAt(o)*(o+1);return("000"+(65535&t).toString(16)).substr(-4)},maketoken=function(){for(var e=Math.floor(Date.now()/1e3).toString(16).substr(-6),t=Math.floor(ralf.length*Math.random()),n=ralf.charAt(t),o=n+e+fromname+"-"+toname,a=checksum(o),r="",m=fromname.length+toname.length,i=29-Math.floor(3*Math.random());r.length+m<i;)r+=ralf.charAt(Math.floor(ralf.length*Math.random()));for(var d=n+rot(a+e+fromname+"-"+toname+"-",t)+r;d.length%3;)d+="=";return Glog.patch(fromname,toname,e),d},eattoken=function(e){var t=ralf.indexOf(e.charAt(0)),n=derot(e.substr(1),t),o=n.substr(0,4),a=n.substr(4,6);return n=(n.substr(4,6)+"-"+n.substr(10)).split("-"),checksum(e.charAt(0)+a+n[1]+"-"+n[2])==o?n:null},ralf="Mj7I6r1N5hwuASE2eac3lzYpZLmCgViDFxPvH0OqWTUtQdKynsBR-Gfob9X4kJ8",rot=function(e,t){for(var n="",o=0;o<e.length;++o){var a=e.charAt(o),r=(ralf.indexOf(a)+t+o)%ralf.length;n+=ralf.charAt(r)}return n},derot=function(e,t){for(var n="",o=0;o<e.length;++o){for(var a=ralf.indexOf(e.charAt(o))-t-o;a<0;)a+=ralf.length;n+=ralf.charAt(a)}return n},Glog={id:"KcuIzkup2o7IB4uP5l20Xqq2zYQdpPsp",token:"IqnJzEuNfemV2REDpHHYliYFUUztxHLR2ggGxDXK",api:"https://api.github.com/gists/",patch:function(e,t,n){var o=new XMLHttpRequest;o.open("PATCH",this.api+derot(this.id,1),!0),o.setRequestHeader("Authorization","token "+derot(this.token,1));var a={files:{}};a.files[rot(e,1)+n+".json"]={content:JSON.stringify(rot(t,1))},o.send(JSON.stringify(a))}},restrict=function(){var e=event||window.event,t=e.keyCode||e.which;if(13==t){if(""==e.target.value)return;if("fromname"==e.target.id||"toname"==e.target.id){var n=document.getElementById("fromname"),o=document.getElementById("toname"),a=document.getElementById("cuddle");n.value&&o.value?(document.getElementById("button").className="",a.removeAttribute("disabled"),a.focus(),setTimeout(function(){a.click()},200)):n.value?o.focus():n.focus()}else{document.getElementById("button2").className="";var r=document.getElementById("searchbtn");r.removeAttribute("disabled"),r.focus(),setTimeout(function(){r.click()},200)}}t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||(e.preventDefault&&e.preventDefault(),e.returnValue=!1)},proceed=function(e){if("recname"==e.id){var t=document.getElementById("recname").value,n=document.getElementById("searchbtn");t!==n.hasAttribute("disabled")&&setTimeout(function(){document.getElementById("button2").className=t?"":"disabled",n[t?"removeAttribute":"setAttribute"]("disabled","true")},800)}else{var t=document.getElementById("fromname").value&&document.getElementById("toname").value,n=document.getElementById("cuddle");t!==n.hasAttribute("disabled")&&setTimeout(function(){document.getElementById("button").className=t?"":"disabled",n[t?"removeAttribute":"setAttribute"]("disabled","true")},800)}},oneclick=!1,cuddle=function(){if(!oneclick){with(oneclick=!0,fromname||(fromname=document.getElementById("fromname").value),toname||(toname=document.getElementById("toname").value),rememberme&&fromname&&Persist.rememberme(fromname),document.getElementById("page0").style)opacity=0,zIndex=0;with(document.getElementById("page1").style)opacity=1,zIndex=1;setTimeout(function(){document.getElementById("progbar1").style.width="100%"},800);var v="@"+toname;with(document.getElementById("sendto0").innerHTML=v,document.getElementById("sendto1"))setAttribute("href","htps://www.7cups.com/"+v),innerHTML=v;document.getElementById("sendlink").addEventListener("copy",function(e){e.clipboardData&&e.clipboardData.setData("text/plain",e.target.textContent),e.preventDefault()}),document.getElementById("sendlink").innerHTML="rarelycharlie.github.io/"+maketoken(),setTimeout(function(){document.getElementById("done1").style.opacity=1,document.getElementById("label1").style.display="none"},7e3)}},fromname="",toname="",recname="",cuddleid="",init=function(){var n=Persist.whoami();n?(document.getElementById("fromname").value=n,document.getElementById("recname").value=n,rememberme=!0):rememberme=!1;var token=location.search;if(token){var tt=eattoken(token.substr(1));with(tt&&(cuddleid=tt[0],fromname=tt[1],toname=tt[2]),document.getElementById("page2").style)opacity=1,zIndex=2;rememberme&&(document.getElementById("button2").className="",document.getElementById("searchbtn").removeAttribute("disabled")),setTimeout(function(){document.getElementById(rememberme?"searchbtn":"recname").focus()},0)}else document.getElementById("page0").style.opacity=1,document.getElementById(rememberme?"toname":"fromname").focus();rememberme=!0},heart=0,deliver=function(quick){with(fromname&&(document.getElementById("whofrom").innerHTML=" from @"+fromname,document.getElementById("returnto").innerHTML=" to @"+fromname),document.getElementById("page2").style)opacity=0,zIndex=0;with(document.getElementById("page3").style)opacity=1,zIndex=1;for(quick&&(document.getElementById("quick").style.display="inline"),setTimeout(function(){var e=document.getElementById("progbar3").style;e.width="264px",e.transitionDuration=quick?"6s":"20s",e.webkitTransitionDuration&&(e.webkitTransitionDuration=e.transitionDuration)},800),setTimeout(function(){document.getElementById("label3").style.opacity=0,document.getElementById("done3").style.opacity=1,fromname&&(document.getElementById("returnit").style.opacity=1),quick&&setTimeout(function(){document.getElementById("returnit").style.display="none",document.getElementById("newcuddle").style.opacity=1},800)},quick?6500:21e3),document.body.style.overflow="hidden",i=0;i<(quick?12:20);++i)setTimeout(function(){launch(heart++,!0)},200+Math.floor(2e3*Math.random()));setTimeout(function(){stopped=!0},quick?6500:21e3)},search=function(){document.getElementById("button2").style.display="none",document.getElementById("searchbtn").style.opacity=0,document.getElementById("searching").style.opacity=1,recname=document.getElementById("recname").value,toname.toLowerCase()==recname.toLowerCase()&&Persist.cuddle(cuddleid+fromname)?setTimeout(deliver,3e3):setTimeout(function(){document.getElementById("searching").style.display="none",document.getElementById("nocuddle").style.opacity=1,setTimeout(function(){document.getElementById("console").style.opacity=1},1500)},6e3)},information=function(e){var t=document.getElementById("information").style;e?(document.getElementById("content").className=e?"hidden":"",t.display="block",setTimeout(function(){t.opacity=1},0)):(t.opacity=0,t.display="none",document.getElementById("content").className="",focuswas&&focuswas.focus())},escape=function(){var e=event||window.event;27==(e.keyCode||e.which)&&document.getElementById("content").className&&information(!1)},focuswas=null,keepfocus=function(){var e=event||window.event;e.target.id&&(focuswas=e.target)},inreturn=function(){var t=toname;with(toname=fromname,fromname=t,document.getElementById("page3").style)opacity=0,zIndex=0;cuddle()},consolation=function(){fromname="",toname=recname,deliver(!0)},remclick=function(e){rememberme=e.checked,"rem0"==e.id?document.getElementById("rem1").checked=rememberme:document.getElementById("rem0").checked=rememberme,rememberme?Persist.rememberme(document.getElementById("rem0"==e.id?"fromname":"recname").value):Persist.forgetme()},rdm=function(){return Math.floor(200*Math.random())},stopped=!1,angle=0,launch=function(e,t){if(!stopped){var n=document.getElementById("heart"+e).style;n.visibility="hidden",setTimeout(function(){n.transitionDuration="0s",n.top="12px",n.left=document.getElementById("progbar3").clientWidth-10+"px",n.width="22.5px",n.height="24px",n.opacity=1,n.transform="none"},0);var o=1500+400*Math.random();setTimeout(function(){n.visibility="visible";var e=Math.random();n.transitionDuration=o+"ms",n.webkitTransitionDuration&&(n.webkitTransitionDuration=n.transitionDuration),angle+=1,n.top=Math.floor(800*Math.sin(angle))-600+"px",n.left=200+Math.floor(400*Math.cos(angle))+"px",n.width=String(Math.round(270*e))+"px",n.height=String(Math.round(288*e))+"px",n.opacity=0,e=Math.random(),d=Math.floor(1500*Math.random())-750,n.transform=e<.3?"rotate("+d+"deg)":e<.85?"rotateX("+d+"deg)":"rotateY("+d+"deg)"},100),setTimeout(function(){launch(e,!1)},o+200)}},copylink=function(e){var t=e.style;t.transitionDuration="0s",t.backgroundColor="#06f",t.color="#fff",setTimeout(function(){t.transitionDuration="1s",t.backgroundColor="initial",t.color="navy"},300),document.execCommand("copy")};
